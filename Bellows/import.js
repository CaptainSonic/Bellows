// Une log simple pour suivi du traitement var log = "Nb de soufflets avant import : " + ds.Soufflets.length;   // Fonction principale function doImportBellows () {     /*   Le fichier à importer est dans un dossier de la solution, un sous-dossier nommé "Import".          On charge la totalité du document d'un seul coup et on le monte en tableau mémoire.     */     var lines, columns, theRef, theMat, theOut;          lines = loadText( ds.getModelFolder().path + "Import/BellowsRef.txt" ).split("\n");       /*   Déclaration des variables du fichier en entrée.            columns[0]    Référence            columns[1]    Code            columns[2]    Matière            columns[3]    Code Matière            columns[4]    Nb Parois            columns[5]    Epaisseur Parois            columns[6]    Nb Ondes            columns[7]    Collet 1            columns[8]    Diam. Collet 1            columns[9]    Collet 2            columns[10]   Diam. Collet 2            columns[11]   Diam. Ext. Onde            columns[12]   Diam. Int. Onde            columns[13]   L2            columns[14]   L3            columns[15]   Raideur            columns[16]   Pression Max. Ext.            columns[17]   Pression Max. Int.            columns[18]   Ref. Outil.            columns[19]   Type Formage                 */    columns = [];       // On boucle sur chaque entrée du tableau lines.forEach( function(oneLine) {        // Recherche les colonnes pour la ligne courante        // Chaque colonne est séparée par une tabulation.columns = oneLine.split("\t");           // Recherche si l'enregistrement existe déjà.      theRef = ds.Soufflets.find("Reference = :1", columns[0]);      if(theRef === null) { // On ne le trouve pas donc on le crée      	theMat = ds.Matieres.find("Code = :1", columns[3]);      	theOut = ds.Outils.find("Référence = :1", columns[18]);      	if(theOut === null) {        		theOut = ds.Outils.find("Référence = :1", "00000");       	}      	theRef = new ds.Soufflets({            Reference : columns[0],            Code : columns[1],            Matiere : theMat,            Nb_Parois : columns[4],            Ep_Parois : columns[5],            Nb_Ondes : columns[6],            Collet1 : columns[7],            Diam_Collet1 : columns[8],            Collet2 : columns[9],            Diam_Collet2 : columns[10],            Ext_Onde : columns[11],            Int_Onde : columns[12],            L2 : columns[13],            L3 : columns[14],            Raideur : columns[15],            Pression_Int : columns[16],            Pression_Ext : columns[17],            Outil : theOut,            Type_Formage : columns[19]         });         // Enregistrer           theRef.save();       } else {       		theMat = ds.Matieres.find("Code = :1", columns[3]);       		theOut = ds.Outils.find("Référence = :1", columns[18]);       		if(theOut === null) {        			theOut = ds.Outils.find("Référence = :1", "00000");       		}       		theRef.Matiere = theMat;       		theRef.Outil = theOut;       		theRef.save();       }     }); } // Call the function doImportBellows ();   // Log resultlog += " / Nb de soufflets après import : " + ds.Soufflets.length;